!function(a){function b(a,b,c){return new Promise(function(d,e){var f=new XMLHttpRequest,g=b;if(c){g+="?";for(key in c)c.hasOwnProperty(key)&&(g+=encodeURIComponent(key)+"="+encodeURIComponent(c[key])+"&")}("POST"===a||"PUT"===a)&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.addEventListener("readystatechange",function(){4===f.readyState&&200===f.status?d(JSON.parse(f.responseText)):4===f.readyState&&200!==f.status&&e("request error")}),f.open(a,g),f.send()})}function c(){d(),a.addEventListener("popstate",d),k("#newsList").delegate("click","a",function(a,b){a.preventDefault();var c=b.getAttribute("href");history.pushState({},document.title,c),d()}),e()}function d(){var b=a.location.pathname;if(/^\/news\/\d+/.test(b)){var c=b.replace(/^\/news\/(\d+)/,"$1");h(c)}else/\//.test(b)&&f();a.ga&&a.ga("send","pageview",a.location.pathname)}function e(){var a=1;localStorage.page=1,j.get("/api/news",{page:a}).then(function(a){b(a),a.total>1&&(k("#pagination").style.display="block")});var b=function(a){var b=a.result;b=i(b);var c="";b.forEach(function(a){c+="<li>",c+='    <a href="/news/'+a.news_id+'">',c+='        <img src="'+a.thumbnail+'">',c+='        <div class="news-summary">',c+='            <span class="news-date">'+a.date+'</span><span class="news-title">'+a.title+"</span>",c+="        </div>",c+="    </a>",c+="</li>"}),k("#newsList").innerHTML+=c};k("#loadMore").addEventListener("click",function(){g(b)})}function f(){k("#newsView").addClass("hide"),k("#indexView").removeClass("hide")}function g(a){var b=localStorage.page||1;b++,j.get("/api/news",{page:b}).then(function(c){a(c),localStorage.page=b,c.total>=b&&(k("#pagination").style.display="none")})}function h(b){k("#indexView").addClass("loading"),j.get("/api/news/"+b).then(function(b){c(b),k("#indexView").className="hide",a.scrollTo(0,0),k("#newsView").removeClass("hide")});var c=function(a){var b=a.result,c="";c+='<div class="news-thumb" style="background-image: url('+b.image+')">',c+='        <div class="image-copyright">图片 '+b.image_source+"</div>",c+="</div>",c+='<div class="news-content">'+b.body+"</div>",k("#newsDetail").innerHTML=c}}function i(a){var b=function(a){try{var b=new Date(1e3*a)}catch(c){console.error("date formatter error",c.message);var b=new Date}return b.toLocaleDateString()};if("[object Array]"===Object.prototype.toString.call(a))a.forEach(function(c,d){a[d].date=b(c.date)});else if("string"==typeof a||"number"==typeof a)var a=b(a);return a}var j={get:function(a,c){return b("GET",a,c)},post:function(a,c){return b("POST",a,c)}},k=function(a){return/^\#.+/.test(a)?document.getElementById(a.replace("#","")):/^\..+/.test(a)?document.getElementsByClassName(a.replace(".","")):void 0};Element.prototype.addClass=function(a){return this.className?this.className+=" "+a:this.className=a,this},Element.prototype.removeClass=function(a){if(!this.className||-1===this.className.indexOf(a))return this;var b=new RegExp("\\s*"+a+"\\s*","g");return this.className=this.className.replace(b,""),this},Element.prototype.delegate=function(a,b,c){this.addEventListener(a,function(a){for(var d=a.target;d.tagName.toLowerCase()!==b&&d.parentNode;)d=d.parentNode;d.tagName.toLowerCase()===b&&c(a,d)})},c()}(this);