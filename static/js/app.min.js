!function(a){function b(){o.init(),p.init(),c(),n.init()}function c(){var a=1;localStorage.page=1,k.get("/api/news",{page:a}).then(function(a){b(a),a.total>1&&(l("#pagination").style.display="block")});var b=function(a){var b=a.result;b=g(b);var c="";b.forEach(function(a){c+="<li>",c+='    <a href="/news/'+a.news_id+'">',c+='        <img src="'+a.thumbnail+'">',c+='        <div class="news-summary">',c+='            <span class="news-date">'+a.date+'</span><span class="news-title">'+a.title+"</span>",c+="        </div>",c+="    </a>",c+="</li>"}),l("#newsList").innerHTML+=c};l("#loadMore").addEventListener("click",function(){e(b)})}function d(){i()||a.scrollTo(0,0),l("#newsView").setTransLate(h()),a.scrollTo(0,0),setTimeout(function(){l("#newsView").addClass("hidden unvisible")},500),l("#indexView").removeAttribute("style")}function e(a){var b=localStorage.page||1;b++,k.get("/api/news",{page:b}).then(function(c){a(c),localStorage.page=b,c.total>=b&&(l("#pagination").style.display="none")})}function f(b){var c=b.id;l("#indexView").removeClass("loading"),k.get("/api/news/"+c).then(function(b){d(b),a.scrollTo(0,0),l("#indexView").removeClass("loading").setTransLate(-h()),l("#newsView").removeClass("hidden").removeAttribute("style"),setTimeout(function(){l("#newsView").removeClass("unvisible")},600),j=b.result.image});var d=function(a){var b=a.result,c="";c+='<div class="news-thumb" style="background-image: url('+b.image+')">',c+='        <div class="image-copyright">图片 '+b.image_source+"</div>",c+="</div>",c+='<div class="news-content">'+b.body+"</div>",l("#newsDetail").innerHTML=c}}function g(a){var b=function(a){try{var b=new Date(1e3*a)}catch(c){console.error("date formatter error",c.message);var b=new Date}return b.toLocaleDateString()};if("[object Array]"===Object.prototype.toString.call(a))a.forEach(function(c,d){a[d].date=b(c.date)});else if("string"==typeof a||"number"==typeof a)var a=b(a);return a}function h(){var b=l("#indexView").offsetHeight,c=a.innerHeight;return b>c?b:c}function i(){return a.innerWidth<=600}var j="",k={get:function(a,b){return this.request("GET",a,b)},post:function(a,b){return this.request("POST",a,b)},request:function(a,b,c){return new Promise(function(d,e){var f=new XMLHttpRequest,g=b;if(c){g+="?";for(key in c)c.hasOwnProperty(key)&&(g+=encodeURIComponent(key)+"="+encodeURIComponent(c[key])+"&")}("POST"===a||"PUT"===a)&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.addEventListener("readystatechange",function(){4===f.readyState&&200===f.status?d(JSON.parse(f.responseText)):4===f.readyState&&200!==f.status&&e("request error")}),f.open(a,g),f.send()})}},l=function(a){return/^\#.+/.test(a)?document.getElementById(a.replace("#","")):/^\..+/.test(a)?document.getElementsByClassName(a.replace(".","")):void 0};Element.prototype.addClass=function(a){return-1!==this.className.indexOf(a)?this:(this.className?this.className+=" "+a:this.className=a,this)},Element.prototype.removeClass=function(a){if(!this.className||-1===this.className.indexOf(a))return this;if(-1===this.className.indexOf(" ")&&this.className===a)return this.removeAttribute("class"),this;var b=this.className.split(" "),c=a!==b[0]&&a!==b[b.length-1]?" ":"",d=new RegExp("\\s*"+a+"\\s*","g");return this.className=this.className.replace(d,c),this},Element.prototype.delegate=function(a,b,c){return this.addEventListener(a,function(a){for(var d=a.target;d.tagName.toLowerCase()!==b&&d.parentNode&&"body"!==d.tagName.toLowerCase();)d=d.parentNode;d.tagName.toLowerCase()===b&&c(a,d)}),this},Element.prototype.setTransLate=function(b){var c="Y",d=a.innerWidth;if(600>=d){var b=0>b?-d:d;c="X"}return this.setAttribute("style","transform:translate"+c+"("+b+"px); -webkit-transform: translate"+c+"("+b+"px);"),this},Element.prototype.addEventListeners=function(a,b){var a=a.split(" "),c=this;a.forEach(function(a){c.addEventListener(a,b)})};var m=function(a,b){args=[].slice.call(arguments,2);var c=function(){a.apply(b||this,args.concat([].slice.call(arguments)))};return c},n={container:l("#shareContainer"),el:l("#shareComponent"),btn:l("#shareBtn"),closer:l("#hideShare"),mask:l("#shareMask"),item:l("#shareBar"),hide:function(){var a=this;this.container.removeClass("show"),setTimeout(function(){a.el.addClass("hide")},300)},show:function(){var a=this;this.el.removeClass("hide"),setTimeout(function(){a.container.addClass("show")},100)},share:function(b){var c="",d=document.title,e=encodeURIComponent(location.href);switch(b){case"twitter":c="http://twitter.com/share?text="+d+"&url="+e;break;case"facebook":c="http://www.facebook.com/sharer.php?u="+e;break;case"google":c="https://plus.google.com/share?url="+e;break;case"weibo":c="http://service.weibo.com/share/share.php?url="+e+"&title="+d+"&pic="+j}c&&a.open(c)},init:function(){var a=this;this.btn.addEventListeners("click touchstart",m(this.show,this)),this.closer.addEventListeners("click touchstart",m(this.hide,this)),this.mask.addEventListeners("click touchstart",m(this.hide,this)),this.item.addEventListener("click",function(b){var c=b.target;if("button"===c.tagName.toLowerCase()){b.preventDefault();var d=c.dataset&&c.dataset.type||"";a.share(d),a.hide()}})}},o={routes:[{url:/\/$/,controller:d},{url:"/news/:id",controller:f}],resolve:function(){a.ga&&a.ga("send","pageview",a.location.pathname)},init:function(){for(var b=this,c=function(a,c){var d=b.routes[a];d.controller(c),d.resolve&&"function"==typeof d.resolve&&d.resolve(),b.resolve()},d=a.location.pathname,e=0,f=this.routes.length;f>e;e++){var g=this.routes[e].url,h={};if("string"==typeof g){if(d===g)return void c(e,h);if("string"==typeof g&&-1!==g.indexOf(":")&&-1!==d.indexOf(g.replace(/(.+)\:.+$/,"$1"))){var i=g.split("/"),j=d.split("/");return i.forEach(function(a,b){-1!==a.indexOf(":")&&(h[a.replace(":","")]=j[b])}),void c(e,h)}}if("[object RegExp]"===Object.prototype.toString.call(g)&&g.test(d))return void c(e,h)}}},p={binding:function(){document.getElementsByTagName("body")[0].delegate("click","a",function(a,b){var c=b.getAttribute("href")||"";/^\/.*$/.test(c)&&(a.preventDefault(),history.pushState({},document.title,c),o.init())})},init:function(){this.binding(),a.addEventListener("popstate",m(o.init,o))}};b()}(this);