!function(a){function b(a,b,c){return new Promise(function(d,e){var f=new XMLHttpRequest,g=b;if(c){g+="?";for(key in c)c.hasOwnProperty(key)&&(g+=encodeURIComponent(key)+"="+encodeURIComponent(c[key])+"&")}("POST"===a||"PUT"===a)&&f.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),f.addEventListener("readystatechange",function(){4===f.readyState&&200===f.status?d(JSON.parse(f.responseText)):4===f.readyState&&200!==f.status&&e("request error")}),f.open(a,g),f.send()})}function c(){d(),e(),a.addEventListener("popstate",e),f(),j()}function d(){document.getElementsByTagName("body")[0].delegate("click","a",function(a,b){var c=b.getAttribute("href")||"";/^\/.*$/.test(c)&&(a.preventDefault(),history.pushState({},document.title,c),e())})}function e(){var b=a.location.pathname;if(/^\/news\/\d+/.test(b)){var c=b.replace(/^\/news\/(\d+)/,"$1");i(c)}else/\//.test(b)&&g();a.ga&&a.ga("send","pageview",a.location.pathname)}function f(){var a=1;localStorage.page=1,m.get("/api/news",{page:a}).then(function(a){b(a),a.total>1&&(n("#pagination").style.display="block")});var b=function(a){var b=a.result;b=k(b);var c="";b.forEach(function(a){c+="<li>",c+='    <a href="/news/'+a.news_id+'">',c+='        <img src="'+a.thumbnail+'">',c+='        <div class="news-summary">',c+='            <span class="news-date">'+a.date+'</span><span class="news-title">'+a.title+"</span>",c+="        </div>",c+="    </a>",c+="</li>"}),n("#newsList").innerHTML+=c};n("#loadMore").addEventListener("click",function(){h(b)})}function g(){n("#newsView").addClass("hide"),n("#indexView").removeClass("hide")}function h(a){var b=localStorage.page||1;b++,m.get("/api/news",{page:b}).then(function(c){a(c),localStorage.page=b,c.total>=b&&(n("#pagination").style.display="none")})}function i(b){n("#indexView").addClass("loading"),m.get("/api/news/"+b).then(function(b){c(b),l=b.result.image,n("#indexView").className="hide",a.scrollTo(0,0),n("#newsView").removeClass("hide")});var c=function(a){var b=a.result,c="";c+='<div class="news-thumb" style="background-image: url('+b.image+')">',c+='        <div class="image-copyright">图片 '+b.image_source+"</div>",c+="</div>",c+='<div class="news-content">'+b.body+"</div>",n("#newsDetail").innerHTML=c}}function j(){var b=function(){n("#shareContainer").removeClass("show"),setTimeout(function(){n("#shareComponent").addClass("hide")},300)};n("#shareBtn").addEventListener("click",function(a){a.preventDefault(),n("#shareComponent").removeClass("hide"),setTimeout(function(){n("#shareContainer").addClass("show")},100)}),n("#hideShare").addEventListener("click",b),n("#shareMask").addEventListener("click",b);var c=function(b){var c="",d=document.title,e=encodeURIComponent(location.href);switch(b){case"twitter":c="http://twitter.com/share?text="+d+"&url="+e;break;case"facebook":c="http://www.facebook.com/sharer.php?u="+e;break;case"google":c="https://plus.google.com/share?url="+e;break;case"weibo":c="http://service.weibo.com/share/share.php?url="+e+"&title="+d+"&pic="+l}c&&a.open(c)};n("#shareBar").addEventListener("click",function(a){var d=a.target;if("button"===d.tagName.toLowerCase()){a.preventDefault();var e=d.dataset&&d.dataset.type||"";c(e),b()}})}function k(a){var b=function(a){try{var b=new Date(1e3*a)}catch(c){console.error("date formatter error",c.message);var b=new Date}return b.toLocaleDateString()};if("[object Array]"===Object.prototype.toString.call(a))a.forEach(function(c,d){a[d].date=b(c.date)});else if("string"==typeof a||"number"==typeof a)var a=b(a);return a}var l="",m={get:function(a,c){return b("GET",a,c)},post:function(a,c){return b("POST",a,c)}},n=function(a){return/^\#.+/.test(a)?document.getElementById(a.replace("#","")):/^\..+/.test(a)?document.getElementsByClassName(a.replace(".","")):void 0};Element.prototype.addClass=function(a){return this.className?this.className+=" "+a:this.className=a,this},Element.prototype.removeClass=function(a){if(!this.className||-1===this.className.indexOf(a))return this;var b=new RegExp("\\s*"+a+"\\s*","g");return this.className=this.className.replace(b,""),this},Element.prototype.delegate=function(a,b,c){this.addEventListener(a,function(a){for(var d=a.target;d.tagName.toLowerCase()!==b&&d.parentNode&&"body"!==d.tagName.toLowerCase();)d=d.parentNode;d.tagName.toLowerCase()===b&&c(a,d)})},c()}(this);